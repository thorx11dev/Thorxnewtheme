Create an **entire, fully functional, high-performance multi-level referral system** for our website. The system must be **stable, accurate, scalable, and error-free**, with clean data handling and smooth performance.

---

## **ğŸ”¹ Referral Logic (Must Be Implemented Exactly)**

### **Level 1 Referral**

* **User A invites User B**
* User A earns **15%** commission from User B
* Commission is **credited ONLY when User B requests a payout**
* No commission is credited before payout request

### **Level 2 Referral**

* **User B invites User C**
* User B earns **15%** commission
* User A earns **7.5%** commission
* Commission is **credited ONLY when User C requests a payout**

---

## **ğŸ”¹ Core Functional Requirements**

### **Referral Tracking**

* Generate a **unique referral link and code** for each user and use them in Referral section of User portal
* Track referral relationships accurately (A â†’ B â†’ C)
* Prevent duplicate referrals, self-referrals, or referral loops
* Ensure referral data persists correctly across sessions

### **Commission Handling**

* Calculate commissions accurately based on referral level
* Credit commissions **only on payout request events**
* Store commission history securely
* Ensure no double credits or race conditions

### **Payout Logic**

* Trigger commission calculation only when a user requests payout
* Distribute earnings to referrers correctly
* Log payout status and transaction history
* Ensure atomic transactions (no partial updates)

---

## **ğŸ”¹ Performance & Stability Requirements**

* Optimized database queries for referral chains
* No performance lag during referral tracking or payout processing
* Safe concurrency handling (multiple users requesting payouts simultaneously)
* Scalable architecture for future referral levels if needed

---

## **ğŸ”¹ UI / UX **

* Referral Section updates for users:

  * Use real link and code instead of Temp/fake
  * Earnings breakdown (Level 1 / Level 2)
  * Apply Referrals Level (Level 1 and Level 2) system in the Leaderboard
* Clear status indicators for payout-based commissions

---

## **ğŸ”¹ Security & Validation**

* Validate all referral relationships server-side
* Prevent manipulation of referral percentages
* Secure referral endpoints and payout logic
* Add logging for audits and debugging

---

## **ğŸ”¹ Final Validation & Testing**

After implementation:

* Perform **deep testing** of all referral flows
* Test edge cases (multiple referrals, delayed payouts, failed payouts)
* Confirm accurate commission distribution
* Ensure zero bugs, zero data inconsistencies, and smooth performance

---

### **âš ï¸ IMPORTANT NOTE**

I want a **complete, production-ready, high-performance referral system** with **no issues, no logic flaws, and no missing functionality**.
This system must work perfectly under real-world usage.

---